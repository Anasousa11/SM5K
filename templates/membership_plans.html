{% extends "base.html" %}

{% block title %}Membership Plans | SinMancha{% endblock %}

{% block content %}
<section class="membership-header">
  <div class="container">
    <h1>Upgrade your plan</h1>
    <p>Choose a membership that fits your goals and commitment level.</p>
  </div>
</section>

<section class="membership-section">
  <div class="container">
    {% if plans %}
      <div class="plans-grid premium">
        {% for plan in plans %}
          <article class="plan-card {% if forloop.counter == plans|length %}plan-featured{% endif %}">
            {% if forloop.counter == plans|length %}
              <div class="plan-badge">RECOMMENDED</div>
            {% endif %}

            <div class="plan-header">
              <h2 class="plan-name">{{ plan.name }}</h2>
              <div class="plan-price-block">
                <span class="plan-currency">£</span>
                <span class="plan-price">{{ plan.price }}</span>
                <span class="plan-billing">/ month</span>
              </div>
            </div>

            {% if plan.description %}
              <p class="plan-tagline">{{ plan.description }}</p>
            {% endif %}

            <!-- Plan features/benefits -->
            <ul class="plan-features">
              {% if forloop.counter == 1 %}
                <li><span class="feature-icon">✓</span> Access to group runs</li>
                <li><span class="feature-icon">✓</span> Community support</li>
                <li><span class="feature-icon">✓</span> Monthly training guides</li>
              {% elif forloop.counter == 2 %}
                <li><span class="feature-icon">✓</span> All starter benefits</li>
                <li><span class="feature-icon">✓</span> One-on-one coaching</li>
                <li><span class="feature-icon">✓</span> Personalized training plans</li>
                <li><span class="feature-icon">✓</span> Priority support</li>
              {% else %}
                <li><span class="feature-icon">✓</span> All pro benefits</li>
                <li><span class="feature-icon">✓</span> Unlimited coaching sessions</li>
                <li><span class="feature-icon">✓</span> Nutrition planning</li>
                <li><span class="feature-icon">✓</span> Performance analytics</li>
                <li><span class="feature-icon">✓</span> VIP events access</li>
              {% endif %}
            </ul>

            <!-- Action button -->
            <div class="plan-action">
              {% if user.is_authenticated and profile %}
                {% if active_membership and active_membership.plan_id == plan.id %}
                  <button class="btn btn-secondary" disabled>Current plan</button>
                {% elif profile.has_active_membership %}
                  <button class="btn btn-outline-secondary" disabled>Upgrade required</button>
                {% else %}
                  <form action="{% url 'create_checkout' plan.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Subscribe now</button>
                  </form>
                {% endif %}
              {% else %}
                <a href="{% url 'account_signup' %}" class="btn btn-primary">Get started</a>
              {% endif %}
            </div>

            {% if plan.trainer %}
              <p class="plan-coach">Coach: <strong>{{ plan.trainer.display_name|default:plan.trainer.user.username }}</strong></p>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p style="text-align: center; padding: 2rem;">No plans available yet.</p>
    {% endif %}
  </div>
</section>
{% endblock %}

